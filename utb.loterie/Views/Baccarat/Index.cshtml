@{
    ViewData["Title"] = "Baccarat";
}

<style>
    .baccarat-table {
        background-color: #0f3b25;
        border: 12px solid #5c3a13;
        border-radius: 30px;
        padding: 30px;
        box-shadow: inset 0 0 100px #000;
        min-height: 600px;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .game-areas {
        display: flex;
        justify-content: space-between;
        gap: 20px;
    }

    .area-box {
        width: 48%;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        min-height: 280px;
        transition: all 0.3s;
        position: relative;
    }

    .player-zone {
        border: 3px solid #3b82f6;
        background: rgba(59, 130, 246, 0.05);
    }

    .banker-zone {
        border: 3px solid #ef4444;
        background: rgba(239, 68, 68, 0.05);
    }

    .zone-title {
        font-size: 1.5rem;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 20px;
        letter-spacing: 2px;
    }

    .text-player {
        color: #3b82f6;
        text-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
    }

    .text-banker {
        color: #ef4444;
        text-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
    }

    .score-badge {
        display: inline-block;
        padding: 2px 15px;
        border-radius: 20px;
        background: #000;
        border: 1px solid #fff;
        font-size: 1.2rem;
        margin-left: 10px;
        min-width: 50px;
    }

    .cards-row {
        display: flex;
        justify-content: center;
        gap: 10px;
        perspective: 1000px;
        min-height: 120px;
    }

    .card {
        width: 90px;
        height: 130px;
        background: #fff;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 5px;
        font-weight: bold;
        font-size: 1.4rem;
        box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
        animation: flipIn 0.6s ease-out;
        color: #000;
    }

    .suit-hearts, .suit-diamonds {
        color: #d00000;
    }

    .suit-clubs, .suit-spades {
        color: #222;
    }

    @@keyframes flipIn {
        from

    {
        transform: rotateY(90deg);
        opacity: 0;
    }

    to {
        transform: rotateY(0);
        opacity: 1;
    }

    }

    .controls-container {
        background: rgba(0,0,0,0.6);
        padding: 20px;
        border-radius: 20px;
        border: 2px solid #d4af37;
        text-align: center;
    }

    .bet-input-group {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
    }

        .bet-input-group .input-group-text {
            background-color: #222;
            color: #d4af37;
            border: 1px solid #444;
            font-weight: bold;
        }

    #stakeInput {
        background-color: #111;
        color: #fff;
        border: 1px solid #444;
        font-size: 1.5rem;
        max-width: 120px;
        text-align: center;
        font-weight: bold;
    }

    .bet-options {
        display: flex;
        justify-content: center;
        gap: 20px;
    }

    .bet-btn {
        width: 140px;
        height: 100px;
        border-radius: 15px;
        border: 2px solid;
        background: rgba(0,0,0,0.8);
        color: #fff;
        font-weight: bold;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-transform: uppercase;
        position: relative;
        overflow: hidden;
    }

    .btn-p {
        border-color: #3b82f6;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
    }

    .btn-t {
        border-color: #10b981;
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
    }

    .btn-b {
        border-color: #ef4444;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
    }

    .bet-btn:hover {
        transform: translateY(-5px);
        cursor: pointer;
    }

    .btn-p:hover {
        background: #3b82f6;
        color: white;
        box-shadow: 0 0 20px #3b82f6;
    }

    .btn-t:hover {
        background: #10b981;
        color: white;
        box-shadow: 0 0 20px #10b981;
    }

    .btn-b:hover {
        background: #ef4444;
        color: white;
        box-shadow: 0 0 20px #ef4444;
    }

    .bet-title {
        font-size: 1.2rem;
        margin-bottom: 5px;
    }

    .odds {
        font-size: 0.8rem;
        opacity: 0.7;
        font-family: monospace;
        background: rgba(0,0,0,0.3);
        padding: 2px 8px;
        border-radius: 5px;
    }


    .win-pulse {
        animation: winPulse 1s infinite alternate;
        color: #4ade80 !important;
        text-shadow: 0 0 15px #4ade80;
    }
    @@keyframes winPulse {
        from

    {
        transform: scale(1);
    }

    to {
        transform: scale(1.1);
    }

    }
</style>

<div class="container mt-5 mb-5">
    <div class="text-center mb-4">
        <h1 class="display-4 fw-bold text-white">ROYAL <span style="color: #ef4444;">BACCARAT</span></h1>
        <p class="text-muted">High Stakes • Punto Banco • 9 vyhrává</p>
    </div>

    <div class="baccarat-table">

        <div class="game-areas">
            <div class="area-box player-zone">
                <div class="zone-title text-player">PLAYER <span id="score-p" class="score-badge">0</span></div>
                <div id="cards-p" class="cards-row"></div>
            </div>

            <div class="area-box banker-zone">
                <div class="zone-title text-banker">BANKER <span id="score-b" class="score-badge">0</span></div>
                <div id="cards-b" class="cards-row"></div>
            </div>
        </div>

        <div class="text-center mb-2" style="height: 30px;">
            <h4 id="status-msg" class="text-white fw-bold text-uppercase" style="letter-spacing: 2px; text-shadow: 0 2px 4px black;">Vsaďte si</h4>
        </div>

        <div class="controls-container">

            <div class="bet-input-group">
                <span class="input-group-text">SÁZKA</span>
                <input type="number" id="stakeInput" class="form-control" value="100" min="10" step="10">
                <span class="input-group-text">Kč</span>
            </div>

            <div class="bet-options">
                <button class="bet-btn btn-p" onclick="play('Player')">
                    <span class="bet-title">PLAYER</span>
                    <span class="odds">1:1</span>
                </button>

                <button class="bet-btn btn-t" onclick="play('Tie')">
                    <span class="bet-title">TIE</span>
                    <span class="odds">8:1</span>
                </button>

                <button class="bet-btn btn-b" onclick="play('Banker')">
                    <span class="bet-title">BANKER</span>
                    <span class="odds">0.95:1</span>
                </button>
            </div>
        </div>

    </div>
</div>

<script>
    async function play(betType) {
        const stakeInput = document.getElementById('stakeInput');
        const status = document.getElementById('status-msg');

        const stake = parseFloat(stakeInput.value);
        if (isNaN(stake) || stake <= 0) {
            status.innerText = "Zadejte platnou sázku!";
            status.className = "text-danger fw-bold";
            return;
        }

        document.getElementById('cards-p').innerHTML = '';
        document.getElementById('cards-b').innerHTML = '';
        document.getElementById('score-p').innerText = '0';
        document.getElementById('score-b').innerText = '0';
        status.innerText = "Rozdávám...";
        status.className = "text-white fw-bold";

        disableButtons(true);

        try {
            const response = await fetch('/Baccarat/Play', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ stake: stake, betType: betType })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.message || "Chyba serveru");
            }

            const data = await response.json();

            await dealCardsAnimated(data.playerCards, 'cards-p');
            await dealCardsAnimated(data.bankerCards, 'cards-b');

            document.getElementById('score-p').innerText = data.playerScore;
            document.getElementById('score-b').innerText = data.bankerScore;

            status.innerText = data.message;
            if (data.winAmount > 0) {
                status.className = "text-success fw-bold win-pulse";
            } else if (data.winner === "Tie") {
                status.className = "text-warning fw-bold";
            } else {
                status.className = "text-danger fw-bold";
            }

            const bal = document.getElementById('userBalance');
            if (bal) {
                bal.innerText = new Intl.NumberFormat('cs-CZ').format(data.newBalance) + " Kč";
                if (data.winAmount > 0) {
                    bal.style.color = "#4ade80";
                    setTimeout(() => bal.style.color = "", 1500);
                }
            }

        } catch (e) {
            console.error(e);
            status.innerText = "Chyba: " + e.message;
            status.className = "text-danger fw-bold";
        } finally {
            disableButtons(false);
        }
    }

    async function dealCardsAnimated(cards, containerId) {
        const container = document.getElementById(containerId);
        for (const c of cards) {
            await new Promise(r => setTimeout(r, 400)); 

            const el = document.createElement('div');
            const suitClass = (c.suit === "Hearts" || c.suit === "Diamonds") ? "suit-hearts" : "suit-clubs";
            const suitSymbol = getSuit(c.suit);
            const rankSymbol = getRank(c.rank);

            el.className = `card ${suitClass}`;
            el.innerHTML = `
                <div style="text-align:left; line-height:1;">${rankSymbol}<br><small style="font-size:0.6em;">${suitSymbol}</small></div>
                <div style="font-size:2.5rem; text-align:center; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">${suitSymbol}</div>
                <div style="text-align:right; transform:rotate(180deg); line-height:1;">${rankSymbol}<br><small style="font-size:0.6em;">${suitSymbol}</small></div>
            `;
            container.appendChild(el);
        }
    }

    function disableButtons(disabled) {
        document.querySelectorAll('.bet-btn').forEach(b => b.disabled = disabled);
    }

    function getSuit(s) { return {'Hearts':'♥️','Diamonds':'♦️','Clubs':'♣️','Spades':'♠️'}[s]; }
    function getRank(r) {
        const map = {'Ace':'A','King':'K','Queen':'Q','Jack':'J','Ten':'10','Nine':'9','Eight':'8','Seven':'7','Six':'6','Five':'5','Four':'4','Three':'3','Two':'2'};
        return map[r] || r;
    }
</script>